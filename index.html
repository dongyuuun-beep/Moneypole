<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MoneyPole - ìŠ¤ë§ˆíŠ¸ ê¸ˆë¦¬ ë¹„êµ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        :root { --primary: #2b6cb0; --accent: #e53e3e; --bg: #f4f7f8; --base-color: #718096; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; color: #333; }
        body.modal-open { overflow: hidden; height: 100vh; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px 0; cursor: pointer; }
        .logo-container { width: 100%; max-width: 280px; height: 60px; margin: 0 auto; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        header img { max-width: 100%; height: auto; object-fit: contain; transform: translateY(-5px) scale(1.15); transition: transform 0.3s ease; }
        .scroll-menu { display: flex; overflow-x: auto; gap: 10px; padding: 15px 0; scrollbar-width: none; }
        .tab-btn { background: #fff; border: 1px solid #ddd; padding: 8px 18px; border-radius: 20px; white-space: nowrap; font-weight: 600; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .filter-section { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        .card { background: #fff; padding: 20px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; }
        .bank-tag { font-size: 11px; color: #888; margin-bottom: 4px; }
        .rate-main { color: var(--accent); font-size: 20px; font-weight: 800; }
        #detailView { display: none; background: #fff; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; z-index: 1000; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; background: #fff; position: sticky; top: 0; z-index: 1001; }
        .back-btn { font-size: 24px; cursor: pointer; margin-right: 15px; padding: 5px; }
        .detail-body { padding: 20px; padding-bottom: 120px; }
        .info-box { background: #f0f7ff; padding: 15px; border-radius: 12px; margin: 15px 0; border-left: 4px solid var(--primary); }
        .info-title { font-size: 14px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .info-content { font-size: 13px; line-height: 1.5; color: #444; white-space: pre-wrap; }
        .chart-container { margin: 20px 0; height: 200px; }
        .calc-box { background: #f8fafc; padding: 20px; border-radius: 12px; margin-top: 20px; border: 1px solid #e2e8f0; }
        .calc-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 18px; margin-top: 10px; box-sizing: border-box; outline-color: var(--primary); }
        .calc-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #666; }
        .calc-total { border-top: 1px solid #eee; margin-top: 12px; padding-top: 12px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .compare-card { background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #edf2f7; }
        .compare-label { font-size: 11px; color: #718096; margin-bottom: 4px; }
        .compare-val { font-size: 15px; font-weight: bold; }
        footer { text-align: center; padding: 40px 20px; border-top: 1px solid #eee; margin-top: 30px; }
        .footer-logo { height: 15px; filter: grayscale(1); opacity: 0.5; margin-bottom: 10px; }
        .disclaimer { font-size: 11px; color: #999; line-height: 1.6; word-break: keep-all; }
        
        /* [ì¶”ê°€] ê³„ì‚°ê¸° ë‚´ ê¸°ê°„ ì„ íƒ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .calc-term-select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #cbd5e0; background: #fff; font-size: 14px; outline: none; }
    </style>
</head>
<body>
    <div class="container" id="mainView">
        <header onclick="location.reload()">
            <div class="logo-container"><img src="logo.png" alt="MoneyPole"></div>
        </header>

        <div class="scroll-menu" id="tabMenu">
            <button class="tab-btn" data-type="parking">íŒŒí‚¹í†µì¥</button>
            <button class="tab-btn active" data-type="deposit">ì˜ˆê¸ˆ</button>
            <button class="tab-btn" data-type="savings">ì ê¸ˆ</button>
            <button class="tab-btn" data-type="cma">CMA</button>
        </div>

        <div class="filter-section">
            <input type="text" id="searchInput" class="search-input" placeholder="ì€í–‰ëª… ë˜ëŠ” ìƒí’ˆëª… ê²€ìƒ‰...">
            <div style="display:flex; justify-content:space-between; font-size:13px; color:#666;">
                <label><input type="checkbox" id="baseOnly"> ìš°ëŒ€ê¸ˆë¦¬ ì œì™¸</label>
                <select id="termSelect" style="border:none; background:none; font-weight: bold; color: var(--primary);" onchange="renderList()">
                    <option value="all">ì „ì²´ ê¸°ê°„</option>
                    <option value="6">6ê°œì›”</option>
                    <option value="12" selected>12ê°œì›”</option>
                    <option value="24">24ê°œì›”</option>
                    <option value="36">36ê°œì›”</option>
                </select>
            </div>
        </div>

        <div id="listArea"></div>

        <footer>
            <img src="logo.png" alt="MoneyPole" class="footer-logo">
            <p class="disclaimer">
                ì£¼ì˜: ìœ„ ì •ë³´ëŠ” ì‹¤ì œ ê¸ˆë¦¬ì™€ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°€ì… ì „ í•´ë‹¹ ê¸ˆìœµê¸°ê´€ì— ë°˜ë“œì‹œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>
                íˆ¬ì ì‹œ ì›ê¸ˆ ì†ì‹¤ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©°, ëª¨ë“  íˆ¬ìì˜ ì±…ì„ì€ íˆ¬ìì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
            </p>
        </footer>
    </div>

    <div id="detailView">
        <div class="detail-header">
            <span class="back-btn" onclick="closeDetail()">â†</span>
            <div id="detailTitle" style="font-weight:bold;">ìƒí’ˆ ìƒì„¸ ì •ë³´</div>
        </div>
        <div class="detail-body">
            <div id="detailBank" style="color:#888; font-size:13px;">ê¸ˆìœµê¸°ê´€</div>
            <div id="detailNameContainer" style="display:flex; align-items: baseline; gap: 8px;">
                <div id="detailName" style="font-size:22px; font-weight:bold; margin:5px 0;">ìƒí’ˆëª…</div>
                <div id="detailTermTag" style="color: var(--primary); font-size: 14px; font-weight: 600;"></div>
            </div>
            
            <div id="detailRateContainer">
                <div id="detailBaseRate" style="font-size: 14px; color: #718096;">ê¸°ë³¸ 0.00%</div>
                <div id="detailRate" style="font-size:36px; font-weight:900; color:var(--accent); line-height: 1.2;">ìµœê³  0.00%</div>
            </div>
            
            <div class="info-box" id="specialConditionBox">
                <div class="info-title">ğŸ’¡ ìš°ëŒ€ê¸ˆë¦¬ ì¡°ê±´</div>
                <div id="detailCondition" class="info-content">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
            </div>

            <div style="margin-top:25px; font-weight:bold; font-size:14px;">ê¸ˆë¦¬ ë³€ë™ ì¶”ì´ (ìµœê³ ê¸ˆë¦¬ ê¸°ì¤€)</div>
            <div class="chart-container"><canvas id="rateChart"></canvas></div>

            <div class="calc-box">
                <div style="font-weight:bold; font-size: 15px; margin-bottom: 10px;">ë§Œê¸° ìˆ˜ë ¹ì•¡ ë¹„êµ ê³„ì‚°ê¸° (ì„¸í›„)</div>
                
                <select id="calcTermSelect" class="calc-term-select" onchange="doCalc()" style="display:none;"></select>
                
                <div id="calcTypeDesc" style="font-size: 12px; color: #2b6cb0; font-weight: 600; margin-bottom: 10px;">ê¸°ì¤€: 12ê°œì›” ë‚©ì…</div>
                <input type="number" id="calcInput" class="calc-input" placeholder="ê¸ˆì•¡ ì…ë ¥" oninput="doCalc()">
                <div id="calcResult" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <script>
        let allData = []; 
        let currentItem = null; 
        let chartInstance = null; 
        let currentType = 'deposit'; 

        fetch('data.json').then(res => res.json()).then(data => {
            allData = data;
            renderList();
        });

        function renderList() {
            const listArea = document.getElementById('listArea');
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const isBaseOnly = document.getElementById('baseOnly').checked;
            const termFilter = document.getElementById('termSelect').value; 
            
            listArea.innerHTML = '';
            let filtered = allData.filter(d => d.type === currentType);

            // [ë³€ê²½ 1] í•„í„° ë¡œì§ ê°œì„ 
            // ê¸°ì¡´ì—ëŠ” ëŒ€í‘œê¸°ê°„(save_trm)ë§Œ ë¹„êµí•˜ì—¬ ìˆ¨ê²¨ë²„ë ¸ìœ¼ë‚˜, 
            // ì´ì œ ëª¨ë“  ê¸°ê°„ì„ ë³´ì¡´í•œ options ë°ì´í„°ê°€ ìˆìœ¼ë¯€ë¡œ, í•´ë‹¹ ê¸°ê°„ì˜ ì˜µì…˜ì´ í•˜ë‚˜ë¼ë„ ì¡´ì¬í•˜ë©´ ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œí•©ë‹ˆë‹¤.
            if (termFilter !== 'all') {
                filtered = filtered.filter(d => {
                    if (d.options && d.options.length > 0) {
                        return d.options.some(o => String(o.save_trm) === termFilter);
                    }
                    return String(d.save_trm) === termFilter;
                });
            }

            if (keyword) filtered = filtered.filter(d => d.bank.includes(keyword) || d.name.includes(keyword));

            filtered.sort((a,b) => (isBaseOnly ? a.base : a.max) < (isBaseOnly ? b.base : b.max) ? 1 : -1);

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                // ë©”ì¸ ë¦¬ìŠ¤íŠ¸ í‘œì¶œì€ ë°ì´í„°ì˜ ëŒ€í‘œê°’(item.save_trm, max, base)ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€
                card.innerHTML = `
                    <div class="bank-tag">${item.bank} | ${item.save_trm}ê°œì›” ê¸°ì¤€</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="prod-name">${item.name}</div>
                        <div class="rate-main">${(isBaseOnly ? item.base : item.max).toFixed(2)}%</div>
                    </div>
                `;
                card.onclick = () => openDetail(item);
                listArea.appendChild(card);
            });
        }

        function openDetail(item) {
            currentItem = item;
            const detailView = document.getElementById('detailView');
            
            detailView.style.display = 'block';
            document.body.classList.add('modal-open');
            detailView.scrollTo(0, 0); 

            document.getElementById('detailBank').innerText = item.bank;
            document.getElementById('detailName').innerText = item.name;
            document.getElementById('detailTermTag').innerText = `${item.save_trm}ê°œì›” ê¸°ì¤€`; 
            
            document.getElementById('detailBaseRate').innerText = `ê¸°ë³¸ ì—° ${item.base.toFixed(2)}%`;
            document.getElementById('detailRate').innerText = `ìµœê³  ì—° ${item.max.toFixed(2)}%`;
            
            document.getElementById('detailCondition').innerText = item.spcl_cnd || "ìš°ëŒ€ ê¸ˆë¦¬ ì¡°ê±´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";

            const calcInput = document.getElementById('calcInput');
            const calcTermSelect = document.getElementById('calcTermSelect');
            
            // [ë³€ê²½ 2] ê³„ì‚°ê¸°ì— ê¸°ê°„ë³„ ëª¨ë“  ë°ì´í„° ë§µí•‘ (ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ ì œê³µ)
            calcTermSelect.innerHTML = ''; // ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™”
            if (item.options && item.options.length > 0) {
                calcTermSelect.style.display = 'block';
                // ê°œì›” ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
                const sortedOpts = [...item.options].sort((a,b) => a.save_trm - b.save_trm);
                sortedOpts.forEach(opt => {
                    const optionEl = document.createElement('option');
                    optionEl.value = opt.save_trm;
                    optionEl.innerText = `${opt.save_trm}ê°œì›” (ê¸°ë³¸ ${opt.intr_rate.toFixed(2)}% / ìµœê³  ${opt.intr_rate2.toFixed(2)}%)`;
                    // ëŒ€í‘œ ê¸°ê°„(item.save_trm)ê³¼ ì¼ì¹˜í•˜ë©´ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒë¨
                    if (opt.save_trm === item.save_trm) optionEl.selected = true; 
                    calcTermSelect.appendChild(optionEl);
                });
            } else {
                // íŒŒí‚¹í†µì¥ì²˜ëŸ¼ optionsê°€ ì—†ëŠ” ê²½ìš° ìˆ¨ê¹€
                calcTermSelect.style.display = 'none';
            }

            if (currentType === 'savings') {
                calcInput.placeholder = "ë§¤ì›” ë‚©ì…í•  ê¸ˆì•¡ ì…ë ¥ (ì›)";
            } else {
                calcInput.placeholder = "í•œ ë²ˆì— ì˜ˆì¹˜í•  ê¸ˆì•¡ ì…ë ¥ (ì›)";
            }

            const history = item.history || [{date: 'í˜„ì¬', rate: item.max}];
            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('rateChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => h.date),
                    datasets: [{
                        label: 'ìµœê³  ê¸ˆë¦¬ ì¶”ì´',
                        data: history.map(h => h.rate),
                        borderColor: '#2b6cb0',
                        tension: 0.3,
                        fill: true,
                        backgroundColor: 'rgba(43, 108, 176, 0.05)'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
            calcInput.value = '';
            document.getElementById('calcResult').innerHTML = '';
            doCalc(); // ì—´ë¦´ ë•Œ ì´ˆê¸° ê³„ì‚° ì‹¤í–‰ ì•ˆë‚´
        }

        function closeDetail() { 
            document.getElementById('detailView').style.display = 'none'; 
            document.body.classList.remove('modal-open');
        }

        function doCalc() {
            const val = parseFloat(document.getElementById('calcInput').value);
            const calcTypeDesc = document.getElementById('calcTypeDesc');
            
            // [ë³€ê²½ 3] ê³„ì‚°ê¸° ê¸°ê°„ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸ˆë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let months = parseInt(currentItem.save_trm) || 12; 
            let applyBaseRate = currentItem.base;
            let applyMaxRate = currentItem.max;

            const calcTermSelect = document.getElementById('calcTermSelect');
            if (currentItem.options && currentItem.options.length > 0 && calcTermSelect.value) {
                // ì‚¬ìš©ìê°€ ê³„ì‚°ê¸°ì—ì„œ ì„ íƒí•œ ê°œì›” ìˆ˜ë¥¼ ë®ì–´ì”Œì›€
                months = parseInt(calcTermSelect.value);
                // ì„ íƒí•œ ê°œì›” ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ì‹¤ì œ ê¸°ë³¸/ìµœê³  ê¸ˆë¦¬ë¥¼ ì°¾ì•„ì„œ ì ìš©
                const selectedOpt = currentItem.options.find(o => o.save_trm === months);
                if (selectedOpt) {
                    applyBaseRate = selectedOpt.intr_rate;
                    applyMaxRate = selectedOpt.intr_rate2;
                }
            }

            // ê°œì›” ìˆ˜ ë³€ê²½ì— ë”°ë¼ ì•ˆë‚´ ë¬¸êµ¬ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            if (currentType === 'savings') {
                calcTypeDesc.innerText = `ê¸°ì¤€: ${months}ê°œì›” ì •ê¸° ì ê¸ˆ (ë‹¨ë¦¬)`;
            } else {
                calcTypeDesc.innerText = `ê¸°ì¤€: ${months}ê°œì›” ê±°ì¹˜ ì˜ˆê¸ˆ (ë‹¨ë¦¬)`;
            }

            if(!val || isNaN(val)) {
                document.getElementById('calcResult').innerHTML = '';
                return;
            }

            // í—¬í¼ í•¨ìˆ˜: ë™ì ìœ¼ë¡œ ì°¾ì•„ë‚¸ ê¸°ê°„ë³„ ê¸ˆë¦¬(applyBaseRate, applyMaxRate)ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
            const getResult = (ratePercent) => {
                const rate = ratePercent / 100;
                let principal = 0;
                let interest = 0;

                if (currentType === 'savings') {
                    principal = val * months;
                    interest = val * rate * (months * (months + 1) / 2 / 12);
                } else {
                    principal = val;
                    interest = val * rate * (months / 12);
                }
                const tax = interest * 0.154;
                return { principal, afterTaxInterest: interest - tax };
            };

            const baseRes = getResult(applyBaseRate);
            const maxRes = getResult(applyMaxRate);

            document.getElementById('calcResult').innerHTML = `
                <div class="compare-grid">
                    <div class="compare-card">
                        <div class="compare-label">ê¸°ë³¸ ê¸ˆë¦¬ (${applyBaseRate.toFixed(2)}%)</div>
                        <div class="compare-val">${Math.floor(baseRes.principal + baseRes.afterTaxInterest).toLocaleString()}ì›</div>
                        <div style="font-size:10px; color:#999; margin-top:4px;">ì´ì: ${Math.floor(baseRes.afterTaxInterest).toLocaleString()}ì›</div>
                    </div>
                    <div class="compare-card" style="border-color: var(--accent); background: #fff5f5;">
                        <div class="compare-label" style="color:var(--accent)">ìµœê³  ê¸ˆë¦¬ (${applyMaxRate.toFixed(2)}%)</div>
                        <div class="compare-val" style="color:var(--accent)">${Math.floor(maxRes.principal + maxRes.afterTaxInterest).toLocaleString()}ì›</div>
                        <div style="font-size:10px; color:var(--accent); margin-top:4px;">ì´ì: ${Math.floor(maxRes.afterTaxInterest).toLocaleString()}ì›</div>
                    </div>
                </div>
                <div class="calc-total" style="margin-top:15px;">
                    <span style="font-size:13px;">ìš°ëŒ€ ê¸ˆë¦¬ í˜œíƒ ì°¨ì´</span>
                    <span style="font-size:18px; color:var(--accent);">+${Math.floor(maxRes.afterTaxInterest - baseRes.afterTaxInterest).toLocaleString()}ì›</span>
                </div>
            `;
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentType = btn.dataset.type;
                renderList();
            };
        });

        document.getElementById('searchInput').oninput = renderList;
        document.getElementById('baseOnly').onchange = renderList;
    </script>
</body>
</html>
