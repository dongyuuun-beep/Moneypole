<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MoneyPole - Ïä§ÎßàÌä∏ Í∏àÎ¶¨ ÎπÑÍµê</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2b6cb0; --accent: #e53e3e; --bg: #f4f7f8; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; color: #333; }
        body.modal-open { overflow: hidden; height: 100vh; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px 0; cursor: pointer; }
        .logo-container { width: 100%; max-width: 280px; height: 60px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        header img { max-width: 100%; height: auto; object-fit: contain; transform: scale(1.15); }
        .scroll-menu { display: flex; overflow-x: auto; gap: 10px; padding: 15px 0; scrollbar-width: none; }
        .tab-btn { background: #fff; border: 1px solid #ddd; padding: 8px 18px; border-radius: 20px; white-space: nowrap; font-weight: 600; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .filter-section { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        .card { background: #fff; padding: 20px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; }
        .bank-tag { font-size: 11px; color: #888; margin-bottom: 4px; }
        .rate-main { color: var(--accent); font-size: 20px; font-weight: 800; }
        #detailView { display: none; background: #fff; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; background: #fff; position: sticky; top: 0; z-index: 1001; }
        .back-btn { font-size: 24px; cursor: pointer; margin-right: 15px; }
        .detail-body { padding: 20px; padding-bottom: 120px; }
        .info-box { background: #f0f7ff; padding: 15px; border-radius: 12px; margin: 15px 0; border-left: 4px solid var(--primary); }
        .info-title { font-size: 14px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .info-content { font-size: 13px; line-height: 1.5; color: #444; white-space: pre-wrap; }
        .calc-box { background: #f8fafc; padding: 20px; border-radius: 12px; margin-top: 20px; border: 1px solid #e2e8f0; }
        .calc-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 18px; margin-top: 10px; box-sizing: border-box; }
        .calc-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #666; }
        .calc-total { border-top: 1px solid #eee; margin-top: 12px; padding-top: 12px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container" id="mainView">
        <header onclick="location.reload()">
            <div class="logo-container"><img src="logo.png" alt="MoneyPole"></div>
        </header>

        <div class="scroll-menu" id="tabMenu">
            <button class="tab-btn" data-type="parking">ÌååÌÇπÌÜµÏû•</button>
            <button class="tab-btn active" data-type="deposit">ÏòàÍ∏à</button>
            <button class="tab-btn" data-type="savings">Ï†ÅÍ∏à</button>
            <button class="tab-btn" data-type="cma">CMA</button>
        </div>

        <div class="filter-section">
            <input type="text" id="searchInput" class="search-input" placeholder="ÏùÄÌñâÎ™Ö ÎòêÎäî ÏÉÅÌíàÎ™Ö Í≤ÄÏÉâ...">
            <div style="display:flex; justify-content:space-between; align-items:center; font-size:13px; color:#666;">
                <label><input type="checkbox" id="baseOnly"> Ïö∞ÎåÄÍ∏àÎ¶¨ Ï†úÏô∏</label>
                <div id="termFilterArea">
                    <select id="termSelect" style="border:none; background:none; font-weight:bold; color:var(--primary);" onchange="renderList()">
                        <option value="all">Ï†ÑÏ≤¥ Í∏∞Í∞Ñ</option>
                        <option value="6">6Í∞úÏõî</option>
                        <option value="12" selected>12Í∞úÏõî</option>
                        <option value="24">24Í∞úÏõî</option>
                        <option value="36">36Í∞úÏõî</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="listArea"></div>
    </div>

    <div id="detailView">
        <div class="detail-header"><span class="back-btn" onclick="closeDetail()">‚Üê</span><div id="detailTitle" style="font-weight:bold;">ÏÉÅÏÑ∏ Ï†ïÎ≥¥</div></div>
        <div class="detail-body">
            <div id="detailBank" style="color:#888; font-size:13px;">Í∏àÏúµÍ∏∞Í¥Ä</div>
            <div id="detailName" style="font-size:22px; font-weight:bold; margin:5px 0;">ÏÉÅÌíàÎ™Ö</div>
            <div id="detailRateArea"></div>

            <div id="detailTermArea" style="margin-top:15px;"></div>

            <div class="info-box">
                <div class="info-title">üí° Ïö∞ÎåÄÍ∏àÎ¶¨ Ï°∞Í±¥</div>
                <div id="detailCondition" class="info-content">ÎÇ¥Ïö©</div>
            </div>

            <div class="calc-box">
                <div style="font-weight:bold; font-size: 15px; margin-bottom: 10px;">ÏÑ∏ÌõÑ ÏàòÎ†πÏï° Í≥ÑÏÇ∞Í∏∞</div>
                <input type="number" id="calcInput" class="calc-input" placeholder="Í∏àÏï° ÏûÖÎ†•" oninput="doCalc()">
                <div id="calcResult" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <script>
        let allData = []; 
        let currentItem = null; 
        let currentType = 'deposit'; 

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        fetch('data.json')
            .then(res => res.json())
            .then(data => {
                allData = data;
                renderList();
            })
            .catch(err => console.error("Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏóêÎü¨:", err));

        function renderList() {
            const listArea = document.getElementById('listArea');
            const termFilterArea = document.getElementById('termFilterArea');
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const isBaseOnly = document.getElementById('baseOnly').checked;
            const termFilter = document.getElementById('termSelect').value;

            // [ÏàòÏ†ï] ÌååÌÇπÌÜµÏû•/CMAÏùº Îïå ÏÉÅÎã® ÌïÑÌÑ∞ Ïà®Í∏∞Í∏∞
            if (currentType === 'parking' || currentType === 'cma') {
                termFilterArea.style.display = 'none';
            } else {
                termFilterArea.style.display = 'block';
            }

            listArea.innerHTML = '';
            let filtered = allData.filter(d => d.type === currentType);

            // Í∏∞Í∞Ñ ÌïÑÌÑ∞ÎßÅ (ÏòàÏ†ÅÍ∏àÎßå)
            if (termFilter !== 'all' && currentType !== 'parking' && currentType !== 'cma') {
                filtered = filtered.filter(d => {
                    if (d.options) return d.options.some(o => String(o.save_trm) === termFilter);
                    return String(d.save_trm) === termFilter;
                });
            }

            // Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
            if (keyword) {
                filtered = filtered.filter(d => d.bank.includes(keyword) || d.name.includes(keyword));
            }

            // Ï§ëÎ≥µ Ï†úÍ±∞ Î∞è Ï†ïÎ†¨
            const unique = {};
            filtered.forEach(item => {
                const key = item.bank + item.name;
                if (!unique[key] || unique[key].max < item.max) unique[key] = item;
            });
            filtered = Object.values(unique).sort((a,b) => (isBaseOnly ? b.base : b.max) - (isBaseOnly ? a.base : a.max));

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                const rate = isBaseOnly ? item.base : item.max;
                card.innerHTML = `
                    <div class="bank-tag">${item.bank} ${currentType !== 'parking' && currentType !== 'cma' ? '| ' + item.save_trm + 'Í∞úÏõî' : ''}</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="font-weight:600;">${item.name}</div>
                        <div class="rate-main">${rate.toFixed(2)}%</div>
                    </div>
                `;
                card.onclick = () => openDetail(item);
                listArea.appendChild(card);
            });
        }

        function openDetail(item) {
            currentItem = JSON.parse(JSON.stringify(item));
            const detailView = document.getElementById('detailView');
            const termArea = document.getElementById('detailTermArea');
            detailView.style.display = 'block';
            document.body.classList.add('modal-open');

            document.getElementById('detailBank').innerText = item.bank;
            document.getElementById('detailName').innerText = item.name;
            document.getElementById('detailCondition').innerText = item.spcl_cnd || "Ïö∞ÎåÄ Ï°∞Í±¥ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.";

            // [ÏàòÏ†ï] ÏÉÅÏÑ∏Ï∞Ω Í∏∞Í∞Ñ Ï§ëÎ≥µ Ï†úÍ±∞ (Ïù¥ÎØ∏ÏßÄ 3Î≤à Ïù¥Ïäà Ìï¥Í≤∞)
            termArea.innerHTML = '';
            if (item.options && item.options.length > 0 && currentType !== 'parking' && currentType !== 'cma') {
                const seen = new Set();
                const uniqueOpts = item.options.filter(o => {
                    if (seen.has(o.save_trm)) return false;
                    seen.add(o.save_trm);
                    return true;
                }).sort((a,b) => a.save_trm - b.save_trm);

                let selectHtml = `<div style="padding:10px; background:#f1f5f9; border-radius:8px; border:1px solid #e2e8f0;">
                    <label style="font-size:12px; color:#666;">Í∏∞Í∞Ñ ÏÑ†ÌÉù</label>
                    <select id="detailTermSelect" onchange="changeDetailTerm(this.value)" style="width:100%; border:none; background:none; font-size:16px; font-weight:bold; margin-top:5px;">`;
                
                uniqueOpts.forEach(opt => {
                    selectHtml += `<option value='${JSON.stringify(opt)}' ${opt.save_trm == item.save_trm ? 'selected' : ''}>${opt.save_trm}Í∞úÏõî</option>`;
                });
                selectHtml += `</select></div>`;
                termArea.innerHTML = selectHtml;
            }

            updateRateDisplay(item.base, item.max);
            document.getElementById('calcInput').value = '';
            document.getElementById('calcResult').innerHTML = '';
        }

        function changeDetailTerm(optStr) {
            const opt = JSON.parse(optStr);
